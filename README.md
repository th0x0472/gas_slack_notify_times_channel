# 概要
召喚されると参加していないTimesチャンネルを返信するbotプログラムです。
Google Apps Scriptで作成されています。

# 使い方

## Google Apps Scriptとしてスクリプトを作成する

1. Cloneした`slack_notify_times_channel.js`をGASのエディタにコピーします。
2. GASの設定から次の2つのスクリプトプロパティを設定します。
  - SLACK_OAUTH_TOKEN -> Slackのbotの管理ページから確認できるOAuthToken。
  - SLACK_DEST_CHANNEL_ID -> botがメッセージを送信するChannelのID。botをChannelに参加させる必要があります。

## デプロイとSlackへの登録

1. GASをWebアプリとしてデプロイしてURLをコピーします。
2. コピーしたURLをSlackアプリのEvent Subscriptionsページに設定します。

# カスタマイズ

## 召喚呪文のカスタマイズ

`handleEvent()`関数の`if`文の評価式の文字列を変更すれば、bot呼び出しの文言をお好みで設定できます。カッコいい文言を設定してください！

## 対象とするチャンネルの命名規則のカスタマイズ

`get_all_times_channels()`関数の71行目の`if`文の評価式をカスタマイズすることで、対象とするチャンネルの命名規則を設定できます。
いまは、弊社のSlackポリシーに沿った `^z-times-` という正規表現が設定されています。
たとえば、Timesチャンネルの命名規則が`times-<who>`というような規則であれば、`/^times-/`とすればOKです。

botが投稿するメッセージも含めてカスタマイズすれば、Timesチャンネルに限らず応用可能だと思います。

## botが送信するメッセージのカスタマイズ

`send_reply()`関数でメッセージを送信しています。

まず33行目で召喚したユーザーへのメンションとbotのメッセージであることを定義しています。

続いて、35行目から48行目の`if`文のブロックで、
- 参加していないTimesチャンネルがある場合
- すべてのTimesチャンネルに参加している場合
に場合分けしてメッセージを組み立てています。

33行目から48行目まではお好みでメッセージを組み立ててください。

今のところは以上です。このスクリプトが何かのお役に立ったりヒントになれば幸いです。
